var EPSILON=0.00001;var linearInterpolate=function(c,b,a){return c+(b-c)*a};var powInterpolate=function(e,d,b,c){return e+(d-e)*Math.pow(b,c)/(Math.pow(b,c)+Math.pow(1-b,c))};var coolInterpolate=function(c,b,a){return powInterpolate(c,b,a,1.3)};var DEFAULT_INTERPOLATOR=coolInterpolate;var _tmpPosStorage=[0,0];function Movable(){newGuard(this,Movable);unobservable.Observable.call(this);var a=this;a.x=0;a.y=0;a.parent=null;a.worldX=0;a.worldY=0;a.currentTask=null;a.trigger("new_state",a)}Movable.prototype=Object.create(unobservable.Observable.prototype);Movable.prototype.updateDisplayPosition=function(c){this.getWorldPosition(_tmpPosStorage);var b=this.worldX;var a=this.worldY;this.worldX=_tmpPosStorage[0];this.worldY=_tmpPosStorage[1];if(b!==this.worldX||a!==this.worldY||c===true){this.trigger("new_display_state",this)}};Movable.prototype.moveTo=function(b,a){if(b!==null){this.x=b}if(a!==null){this.y=a}this.trigger("new_state",this)};Movable.prototype.moveToFast=function(b,a){this.x=b;this.y=a;this.trigger("new_state",this)};Movable.prototype.isBusy=function(){return this.currentTask!==null};Movable.prototype.makeSureNotBusy=function(){if(this.isBusy()){console.error("Attempt to use movable while it was busy",this);throw ({message:"Object is busy - you should use callback",obj:this})}};Movable.prototype.wait=function(c,a){this.makeSureNotBusy();var d=0;var b=this;b.currentTask=function e(f){d+=f;if(d>c){b.currentTask=null;if(a){a()}}}};Movable.prototype.moveToOverTime=function(a,j,b,d,c){this.makeSureNotBusy();this.currentTask=true;if(a===null){a=this.x}if(j===null){j=this.y}if(typeof d==="undefined"){d=DEFAULT_INTERPOLATOR}var f=this.x;var e=this.y;var g=0;var i=this;i.currentTask=function h(l){g=Math.min(b,g+l);if(g===b){i.moveToFast(a,j);i.currentTask=null;if(c){c()}}else{var k=g/b;i.moveToFast(d(f,a,k),d(e,j,k))}}};Movable.prototype.update=function(a){if(this.currentTask!==null){this.currentTask(a)}};Movable.prototype.getWorldPosition=function(d){var c=this.x;var b=this.y;var a=this.parent;while(a!==null){c+=a.x;b+=a.y;a=a.parent}d[0]=c;d[1]=b};Movable.prototype.setParent=function(c){var a=[0,0];if(c===null){if(this.parent!==null){this.getWorldPosition(a);this.parent=null;this.moveToFast(a[0],a[1])}}else{this.getWorldPosition(a);var b=[0,0];c.getWorldPosition(b);this.parent=c;this.moveToFast(a[0]-b[0],a[1]-b[1])}};